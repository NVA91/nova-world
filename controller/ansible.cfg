# ============================================================================
# ansible.cfg - Ansible Test Controller Konfiguration
# ============================================================================
# Diese Datei wird vom Docker-Container verwendet, um Ansible zu konfigurieren.
# Sie können diese Datei anpassen oder durch eine eigene ersetzen.

[defaults]
# ============================================================================
# SECTION 1: Grundlegende Konfiguration
# ============================================================================

# Inventory-Pfad (kann überschrieben werden)
inventory = ./inventory

# Rollen-Pfad (inkl. shared)
roles_path = ../shared/roles:./roles

# Library-Pfad (für Custom Modules, inkl. shared)
library = ../shared/library:./library

# Lookup-Plugins (inkl. shared)
lookup_plugins = ../shared/plugins/lookup:./lookup_plugins

# Filter-Plugins (inkl. shared)
filter_plugins = ../shared/plugins/filter:./filter_plugins

# ============================================================================
# SECTION 2: Host-Konfiguration
# ============================================================================

# Deaktiviere Host-Key-Checking (für CI/CD und Tests)
host_key_checking = False

# SSH-Konfiguration
ssh_args = -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null

# Timeout für SSH-Verbindungen (in Sekunden)
timeout = 10

# ============================================================================
# SECTION 3: Ausgabe und Logging
# ============================================================================

# Farb-Ausgabe erzwingen
force_color = True

# Verbosity-Level (0-4)
# 0 = normal, 1 = verbose (-v), 2 = very verbose (-vv), etc.
verbosity = 0

# Zeige Skipped-Tasks
display_skipped_hosts = True

# Zeige Aufgaben-Timing
callback_whitelist = profile_tasks, timer, log_plays

# ============================================================================
# SECTION 4: Sicherheit
# ============================================================================

# Deaktiviere Warnings für veraltete Features
deprecation_warnings = False

# Verwende lokale Verbindung für localhost
connection = local

# ============================================================================
# SECTION 5: Parallelisierung
# ============================================================================

# Anzahl der parallelen Prozesse (Standard: 5)
forks = 10

# ============================================================================
# SECTION 6: Retry-Datei
# ============================================================================

# Speichere Retry-Datei
retry_files_enabled = True
retry_files_save_path = ./

# ============================================================================
# SECTION 7: Gathering Facts
# ============================================================================

# Gathering-Strategie
gathering = smart
fact_caching = jsonfile
fact_caching_connection = /tmp/ansible_facts
fact_caching_timeout = 86400

# ============================================================================
# SECTION 8: Privilege Escalation
# ============================================================================

# Sudo-Konfiguration (optional)
# become_method = sudo
# become_user = root
# become_ask_pass = False

[inventory]
# ============================================================================
# Inventory-spezifische Konfiguration
# ============================================================================

# Verwende Plugins für dynamische Inventories
enable_plugins = ini, yaml, aws_ec2, docker_container

[privilege_escalation]
# ============================================================================
# Privilege Escalation Konfiguration
# ============================================================================

# Methode für Privilege Escalation
become_method = sudo

# Benutzer für Escalation
become_user = root

# Passwort nicht abfragen (wird über SSH-Keys gelöst)
become_ask_pass = False

[ssh_connection]
# ============================================================================
# SSH-Verbindungs-Konfiguration
# ============================================================================

# Pipelining aktivieren (schneller, aber erfordert requiretty=False in sudoers)
pipelining = True

# SSH-Kontrollmaster verwenden
control_path = /tmp/ansible-ssh-%%h-%%p-%%r

# ============================================================================
# SECTION 9: Callback Plugins
# ============================================================================

[callback_log_plays]
# Logging für Plays aktivieren
log_plays = True
